image: node:8
stages:
  - deploy

deploy:
  stage: deploy
  script:
    - apt-get update && apt-get install -y lftp
    - npm install --unsafe-perm -g @angular/cli@1.7.0
    - npm install --unsafe-perm
    - echo 'BUILD STARTED'
    - ng build --prod
    - echo 'BUILD FINISHED'
    - git config git-ftp.url $FTP_HOST
    - git config git-ftp.password $FTP_PASSWORD
    - git config git-ftp.user $FTP_USER
    - git ftp init
    - lftp -u $FTP_USER,$FTP_PASSWORD fto.benimfirsatim.com -e "mirror -R -p dist/ / ; quit"
  except:
    - tags